2025-09-03 17:46:56,754 - src.database.mongodb_client - ERROR - 创建索引失败: db already exists with different case already have: [StockData] trying to create [stockdata], full error: {'ok': 0.0, 'errmsg': 'db already exists with different case already have: [StockData] trying to create [stockdata]', 'code': 13297, 'codeName': 'DatabaseDifferCase'}
2025-09-03 17:46:56,757 - src.database.mongodb_client - INFO - 成功连接到MongoDB: stockdata
2025-09-03 17:46:57,468 - src.database.mongodb_client - ERROR - 插入Tick数据失败: batch op errors occurred, full error: {'writeErrors': [{'index': 0, 'code': 13297, 'errmsg': 'db already exists with different case already have: [StockData] trying to create [stockdata]', 'op': {'symbol': 'TEST.001', 'price': 100.0, 'created_at': datetime.datetime(2025, 9, 3, 17, 46, 57, 2398), 'test': True, '_id': ObjectId('68b80e9162584106fd3ebcc9')}}], 'writeConcernErrors': [], 'nInserted': 0, 'nUpserted': 0, 'nMatched': 0, 'nModified': 0, 'nRemoved': 0, 'upserted': []}
2025-09-03 17:46:57,507 - src.services.gm_service - INFO - 掘金量化SDK初始化成功
2025-09-03 17:46:57,514 - src.scheduler.data_sync - INFO - 开始同步历史数据: SZSE.000001
2025-09-03 17:46:57,686 - src.services.gm_service - INFO - 查询历史行情: SZSE.000001, 频率: 1d, 时间范围: 2025-08-04 - 2025-09-03
2025-09-03 17:47:02,644 - src.services.gm_service - INFO - 成功获取 23 条历史行情数据
2025-09-03 17:47:02,646 - src.database.mongodb_client - ERROR - 更新Bar数据失败: {'replaceOne': {'filter': {'symbol': 'SZSE.000001', 'frequency': '1d', 'eob': datetime.datetime(2025, 8, 4, 0, 0, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800), 'Asia/Shanghai'))}, 'replacement': {'symbol': 'SZSE.000001', 'frequency': '1d', 'open': 12.24, 'close': 12.3, 'high': 12.38, 'low': 12.21, 'amount': 1271376406.58, 'volume': 103268969, 'bob': datetime.datetime(2025, 8, 4, 0, 0, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800), 'Asia/Shanghai')), 'eob': datetime.datetime(2025, 8, 4, 0, 0, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800), 'Asia/Shanghai')), 'position': 0}, 'upsert': True}} is not a valid request
2025-09-03 17:47:02,752 - src.database.mongodb_client - ERROR - 记录同步日志失败: db already exists with different case already have: [StockData] trying to create [stockdata], full error: {'index': 0, 'code': 13297, 'errmsg': 'db already exists with different case already have: [StockData] trying to create [stockdata]'}
2025-09-03 17:47:02,756 - src.scheduler.data_sync - INFO - 历史数据同步完成: SZSE.000001, 记录数: 23
2025-09-03 17:47:02,758 - src.scheduler.data_sync - INFO - 开始同步实时数据: ['SZSE.000001']
2025-09-03 17:47:02,759 - src.services.gm_service - INFO - 查询当前行情: ['SZSE.000001']
2025-09-03 17:47:03,163 - src.services.gm_service - INFO - 成功获取 1 条当前行情数据
2025-09-03 17:47:03,294 - src.database.mongodb_client - ERROR - 插入Tick数据失败: batch op errors occurred, full error: {'writeErrors': [{'index': 0, 'code': 13297, 'errmsg': 'db already exists with different case already have: [StockData] trying to create [stockdata]', 'op': {'symbol': 'SZSE.000001', 'open': 11.98, 'high': 12.01, 'low': 11.74, 'price': 11.75, 'cum_volume': 136723249, 'cum_amount': 1619322977.46, 'cum_position': 0, 'trade_type': 8, 'last_volume': 0, 'last_amount': 0.0, 'created_at': datetime.datetime(2025, 9, 3, 15, 34, 33, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800), 'Asia/Shanghai')), 'quotes': [{'bid_p': 11.75, 'bid_v': 278137, 'ask_p': 11.76, 'ask_v': 411900}, {'bid_p': 11.74, 'bid_v': 1077982, 'ask_p': 11.77, 'ask_v': 147100}, {'bid_p': 11.73, 'bid_v': 600100, 'ask_p': 11.78, 'ask_v': 340600}, {'bid_p': 11.72, 'bid_v': 550900, 'ask_p': 11.79, 'ask_v': 99800}, {'bid_p': 11.71, 'bid_v': 895300, 'ask_p': 11.8, 'ask_v': 360600}], 'iopv': 0.0, '_id': ObjectId('68b80e9762584106fd3ebccb')}}], 'writeConcernErrors': [], 'nInserted': 0, 'nUpserted': 0, 'nMatched': 0, 'nModified': 0, 'nRemoved': 0, 'upserted': []}
2025-09-03 17:47:03,445 - src.database.mongodb_client - ERROR - 记录同步日志失败: db already exists with different case already have: [StockData] trying to create [stockdata], full error: {'index': 0, 'code': 13297, 'errmsg': 'db already exists with different case already have: [StockData] trying to create [stockdata]'}
2025-09-03 17:47:03,447 - src.scheduler.data_sync - INFO - 实时数据同步完成, 记录数: 1
2025-09-03 17:47:03,455 - src.scheduler.data_sync - INFO - 开始同步分钟数据: SZSE.000001
2025-09-03 17:47:03,457 - src.services.gm_service - INFO - 查询历史行情: SZSE.000001, 频率: 60s, 时间范围: 2025-09-03 16:47:03 - 2025-09-03 17:47:03
2025-09-03 17:47:04,714 - src.services.gm_service - INFO - 成功获取 0 条历史行情数据
2025-09-03 17:47:04,717 - src.scheduler.data_sync - INFO - 分钟数据同步完成: SZSE.000001, 无新数据
2025-09-03 17:47:04,909 - src.services.gm_service - INFO - 掘金量化SDK初始化成功
2025-09-03 17:47:04,922 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-09-03 17:47:04,934 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-09-03 17:47:04,944 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-09-03 17:47:04,948 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-09-03 17:47:04,979 - apscheduler.scheduler - INFO - Added job "每日历史数据同步" to job store "default"
2025-09-03 17:47:04,986 - apscheduler.scheduler - INFO - Added job "实时数据同步" to job store "default"
2025-09-03 17:47:04,989 - apscheduler.scheduler - INFO - Added job "分钟数据同步" to job store "default"
2025-09-03 17:47:04,990 - apscheduler.scheduler - INFO - Added job "健康检查" to job store "default"
2025-09-03 17:47:04,993 - apscheduler.scheduler - INFO - Scheduler started
2025-09-03 17:47:04,993 - src.scheduler.scheduler_service - INFO - 调度器启动成功
2025-09-03 17:47:04,995 - src.scheduler.scheduler_service - INFO - 已注册 4 个任务:
2025-09-03 17:47:04,996 - src.scheduler.scheduler_service - INFO -   - 实时数据同步 (ID: realtime_sync)
2025-09-03 17:47:04,996 - src.scheduler.scheduler_service - INFO -   - 健康检查 (ID: health_check)
2025-09-03 17:47:04,997 - src.scheduler.scheduler_service - INFO -   - 分钟数据同步 (ID: minute_data_sync)
2025-09-03 17:47:04,999 - src.scheduler.scheduler_service - INFO -   - 每日历史数据同步 (ID: daily_history_sync)
2025-09-03 17:47:35,426 - apscheduler.executors.default - INFO - Running job "实时数据同步 (trigger: interval[0:00:30], next run at: 2025-09-03 17:48:04 CST)" (scheduled at 2025-09-03 17:47:34.933484+08:00)
2025-09-03 17:47:35,589 - apscheduler.executors.default - INFO - Job "实时数据同步 (trigger: interval[0:00:30], next run at: 2025-09-03 17:48:04 CST)" executed successfully
2025-09-03 17:47:35,792 - src.scheduler.scheduler_service - INFO - 开始执行每日历史数据同步
2025-09-03 17:47:35,804 - src.scheduler.data_sync - INFO - 开始同步历史数据: SZSE.000001
2025-09-03 17:47:35,882 - src.scheduler.scheduler_service - INFO - 任务执行成功: realtime_sync
2025-09-03 17:47:36,141 - src.services.gm_service - INFO - 查询历史行情: SZSE.000001, 频率: 1d, 时间范围: 2025-08-04 - 2025-09-03
2025-09-03 17:47:37,490 - src.services.gm_service - INFO - 成功获取 23 条历史行情数据
2025-09-03 17:47:37,513 - src.database.mongodb_client - ERROR - 更新Bar数据失败: {'replaceOne': {'filter': {'symbol': 'SZSE.000001', 'frequency': '1d', 'eob': datetime.datetime(2025, 8, 4, 0, 0, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800), 'Asia/Shanghai'))}, 'replacement': {'symbol': 'SZSE.000001', 'frequency': '1d', 'open': 12.24, 'close': 12.3, 'high': 12.38, 'low': 12.21, 'amount': 1271376406.58, 'volume': 103268969, 'bob': datetime.datetime(2025, 8, 4, 0, 0, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800), 'Asia/Shanghai')), 'eob': datetime.datetime(2025, 8, 4, 0, 0, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800), 'Asia/Shanghai')), 'position': 0}, 'upsert': True}} is not a valid request
2025-09-03 17:47:37,546 - src.database.mongodb_client - ERROR - 记录同步日志失败: db already exists with different case already have: [StockData] trying to create [stockdata], full error: {'index': 0, 'code': 13297, 'errmsg': 'db already exists with different case already have: [StockData] trying to create [stockdata]'}
2025-09-03 17:47:37,548 - src.scheduler.data_sync - INFO - 历史数据同步完成: SZSE.000001, 记录数: 23
2025-09-03 17:47:37,548 - src.scheduler.data_sync - INFO - 开始同步历史数据: SHSE.600111
2025-09-03 17:47:37,554 - src.services.gm_service - INFO - 查询历史行情: SHSE.600111, 频率: 1d, 时间范围: 2025-08-04 - 2025-09-03
2025-09-03 17:47:37,824 - src.services.gm_service - INFO - 成功获取 23 条历史行情数据
2025-09-03 17:47:37,827 - src.database.mongodb_client - ERROR - 更新Bar数据失败: {'replaceOne': {'filter': {'symbol': 'SHSE.600111', 'frequency': '1d', 'eob': datetime.datetime(2025, 8, 4, 0, 0, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800), 'Asia/Shanghai'))}, 'replacement': {'symbol': 'SHSE.600111', 'frequency': '1d', 'open': 35.7, 'close': 36.3, 'high': 36.35, 'low': 35.7, 'amount': 5677354057.17, 'volume': 157435542, 'bob': datetime.datetime(2025, 8, 4, 0, 0, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800), 'Asia/Shanghai')), 'eob': datetime.datetime(2025, 8, 4, 0, 0, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800), 'Asia/Shanghai')), 'position': 0}, 'upsert': True}} is not a valid request
2025-09-03 17:47:37,838 - src.database.mongodb_client - ERROR - 记录同步日志失败: db already exists with different case already have: [StockData] trying to create [stockdata], full error: {'index': 0, 'code': 13297, 'errmsg': 'db already exists with different case already have: [StockData] trying to create [stockdata]'}
2025-09-03 17:47:37,839 - src.scheduler.data_sync - INFO - 历史数据同步完成: SHSE.600111, 记录数: 23
2025-09-03 17:47:37,843 - src.scheduler.scheduler_service - INFO - 每日历史数据同步完成: 0/2 成功
2025-09-03 17:47:37,844 - src.scheduler.scheduler_service - INFO - 立即触发任务成功: daily_history_sync
2025-09-03 17:47:37,849 - src.scheduler.scheduler_service - INFO - 调度器已停止
2025-09-03 17:47:37,874 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-09-03 17:48:01,636 - src.services.gm_service - INFO - 掘金量化SDK初始化成功
2025-09-03 17:48:01,653 - src.scheduler.scheduler_service - INFO - 手动启动实时数据同步
2025-09-03 17:48:01,655 - src.scheduler.data_sync - INFO - 启动实时数据同步: ['SZSE.000001', 'SHSE.600111']
2025-09-03 17:49:01,669 - src.scheduler.scheduler_service - INFO - 手动停止实时数据同步
2025-09-03 17:49:01,671 - src.scheduler.data_sync - INFO - 停止实时数据同步
2025-09-03 17:49:01,728 - src.database.mongodb_client - INFO - MongoDB连接已断开
2025-09-03 17:49:26,066 - src.database.mongodb_client - INFO - 数据库索引创建完成
2025-09-03 17:49:26,066 - src.database.mongodb_client - INFO - 成功连接到MongoDB: StockData
2025-09-03 17:49:26,074 - src.database.mongodb_client - INFO - 成功插入 1 条Tick数据
2025-09-03 17:49:26,075 - src.services.gm_service - INFO - 掘金量化SDK初始化成功
2025-09-03 17:49:26,075 - src.scheduler.data_sync - INFO - 开始同步历史数据: SZSE.000001
2025-09-03 17:49:26,087 - src.services.gm_service - INFO - 查询历史行情: SZSE.000001, 频率: 1d, 时间范围: 2025-08-04 - 2025-09-03
2025-09-03 17:49:26,309 - src.services.gm_service - INFO - 成功获取 23 条历史行情数据
2025-09-03 17:49:26,321 - src.database.mongodb_client - INFO - 成功处理 23 条Bar数据
2025-09-03 17:49:26,324 - src.scheduler.data_sync - INFO - 历史数据同步完成: SZSE.000001, 记录数: 23
2025-09-03 17:49:26,325 - src.scheduler.data_sync - INFO - 开始同步实时数据: ['SZSE.000001']
2025-09-03 17:49:26,325 - src.services.gm_service - INFO - 查询当前行情: ['SZSE.000001']
2025-09-03 17:49:26,403 - src.services.gm_service - INFO - 成功获取 1 条当前行情数据
2025-09-03 17:49:26,408 - src.database.mongodb_client - INFO - 成功插入 1 条Tick数据
2025-09-03 17:49:26,411 - src.scheduler.data_sync - INFO - 实时数据同步完成, 记录数: 1
2025-09-03 17:49:26,412 - src.scheduler.data_sync - INFO - 开始同步分钟数据: SZSE.000001
2025-09-03 17:49:26,412 - src.services.gm_service - INFO - 查询历史行情: SZSE.000001, 频率: 60s, 时间范围: 2025-09-03 16:49:26 - 2025-09-03 17:49:26
2025-09-03 17:49:26,498 - src.services.gm_service - INFO - 成功获取 0 条历史行情数据
2025-09-03 17:49:26,498 - src.scheduler.data_sync - INFO - 分钟数据同步完成: SZSE.000001, 无新数据
2025-09-03 17:49:26,608 - src.services.gm_service - INFO - 掘金量化SDK初始化成功
2025-09-03 17:49:26,609 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-09-03 17:49:26,609 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-09-03 17:49:26,610 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-09-03 17:49:26,610 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-09-03 17:49:26,613 - apscheduler.scheduler - INFO - Added job "每日历史数据同步" to job store "default"
2025-09-03 17:49:26,613 - apscheduler.scheduler - INFO - Added job "实时数据同步" to job store "default"
2025-09-03 17:49:26,614 - apscheduler.scheduler - INFO - Added job "分钟数据同步" to job store "default"
2025-09-03 17:49:26,614 - apscheduler.scheduler - INFO - Added job "健康检查" to job store "default"
2025-09-03 17:49:26,615 - apscheduler.scheduler - INFO - Scheduler started
2025-09-03 17:49:26,616 - src.scheduler.scheduler_service - INFO - 调度器启动成功
2025-09-03 17:49:26,616 - src.scheduler.scheduler_service - INFO - 已注册 4 个任务:
2025-09-03 17:49:26,617 - src.scheduler.scheduler_service - INFO -   - 实时数据同步 (ID: realtime_sync)
2025-09-03 17:49:26,617 - src.scheduler.scheduler_service - INFO -   - 健康检查 (ID: health_check)
2025-09-03 17:49:26,617 - src.scheduler.scheduler_service - INFO -   - 分钟数据同步 (ID: minute_data_sync)
2025-09-03 17:49:26,618 - src.scheduler.scheduler_service - INFO -   - 每日历史数据同步 (ID: daily_history_sync)
2025-09-03 17:49:56,681 - src.scheduler.scheduler_service - INFO - 开始执行每日历史数据同步
2025-09-03 17:49:56,689 - src.scheduler.data_sync - INFO - 开始同步历史数据: SZSE.000001
2025-09-03 17:49:56,698 - apscheduler.executors.default - INFO - Running job "实时数据同步 (trigger: interval[0:00:30], next run at: 2025-09-03 17:50:26 CST)" (scheduled at 2025-09-03 17:49:56.609060+08:00)
2025-09-03 17:49:56,702 - apscheduler.executors.default - INFO - Job "实时数据同步 (trigger: interval[0:00:30], next run at: 2025-09-03 17:50:26 CST)" executed successfully
2025-09-03 17:49:56,712 - src.scheduler.scheduler_service - INFO - 任务执行成功: realtime_sync
2025-09-03 17:49:56,713 - src.services.gm_service - INFO - 查询历史行情: SZSE.000001, 频率: 1d, 时间范围: 2025-09-03 - 2025-09-03
2025-09-03 17:49:56,968 - src.services.gm_service - INFO - 成功获取 1 条历史行情数据
2025-09-03 17:49:56,976 - src.database.mongodb_client - INFO - 成功处理 1 条Bar数据
2025-09-03 17:49:56,980 - src.scheduler.data_sync - INFO - 历史数据同步完成: SZSE.000001, 记录数: 1
2025-09-03 17:49:56,981 - src.scheduler.data_sync - INFO - 开始同步历史数据: SHSE.600111
2025-09-03 17:49:57,027 - src.services.gm_service - INFO - 查询历史行情: SHSE.600111, 频率: 1d, 时间范围: 2025-08-04 - 2025-09-03
2025-09-03 17:49:57,070 - src.services.gm_service - INFO - 成功获取 23 条历史行情数据
2025-09-03 17:49:57,078 - src.database.mongodb_client - INFO - 成功处理 23 条Bar数据
2025-09-03 17:49:57,131 - src.scheduler.data_sync - INFO - 历史数据同步完成: SHSE.600111, 记录数: 23
2025-09-03 17:49:57,132 - src.scheduler.scheduler_service - INFO - 每日历史数据同步完成: 2/2 成功
2025-09-03 17:49:57,132 - src.scheduler.scheduler_service - INFO - 立即触发任务成功: daily_history_sync
2025-09-03 17:49:57,133 - src.scheduler.scheduler_service - INFO - 调度器已停止
2025-09-03 17:49:57,136 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-09-03 17:50:41,649 - src.services.gm_service - INFO - 掘金量化SDK初始化成功
2025-09-03 17:50:41,654 - src.scheduler.scheduler_service - INFO - 手动启动实时数据同步
2025-09-03 17:50:41,655 - src.scheduler.data_sync - INFO - 启动实时数据同步: ['SZSE.000001', 'SHSE.600111']
2025-09-03 17:51:41,736 - src.scheduler.scheduler_service - INFO - 手动停止实时数据同步
2025-09-03 17:51:41,764 - src.scheduler.data_sync - INFO - 停止实时数据同步
2025-09-03 17:51:41,989 - src.database.mongodb_client - INFO - MongoDB连接已断开
